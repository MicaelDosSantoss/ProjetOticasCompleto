<!DOCTYPE html>
<html>
<head>
    <title>Lista de Materiais</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"
          integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/materiais.css') }}">
    <script>
        function toggleForm() {
    const formDiv = document.getElementById('formMaterial');
    formDiv.style.display = formDiv.style.display === 'none' ? 'block' : 'none';
}

function deletarMaterial(idMaterial) {
    fetch('/material/delete/' + idMaterial, { method: 'DELETE' })
        .then(response => {
            if (response.ok) {
                location.reload();
            } else {
                alert('Erro ao deletar o material.');
            }
        })
        .catch(error => {
            console.error('Erro na requisição:', error);
            alert('Erro ao tentar deletar o material.');
        });
}

function preencherFormularioEdicao(id, nome) {
    document.getElementById('editID').value = id;
    document.getElementById('editNome').value = nome;
    document.getElementById('formMaterialEdit').style.display = 'block';
    window.scrollTo(0, 0);
}

function atualizarMaterial() {
    const id = document.getElementById('editID').value;
    const nome = document.getElementById('editNome').value;

    fetch('/material/edit/' + id, {
        method: 'PUT',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({ Nome: nome })
    })
    .then(response => {
        if (response.ok) {
            alert('Material atualizado com sucesso!');
            location.reload();
        } else {
            alert('Erro ao atualizar o material.');
        }
    })
    .catch(error => {
        console.error('Erro ao enviar atualização:', error);
        alert('Erro ao enviar a atualização.');
    });
}
    </script>
</head>
<body>
<div class="container table-wrapper">
    <h1 class="text-center">Material</h1>

    {% if error %}
        <div class="alert alert-warning text-center">{{ error }}</div>
    {% endif %}

    <!-- Botão para mostrar o formulário de criação -->
    <div class="text-center mb-3">
        <button class="btn btn-success" onclick="toggleForm()">+ Novo Material</button>
    </div>

    <!-- Formulário de criação (POST) -->
    <div id="formMaterial" style="display: none;" class="mb-4">
        <form action="/material" method="POST" class="form-inline justify-content-center">
            <div class="form-group mx-sm-3 mb-2">
                <input type="text" class="form-control" name="Nome" placeholder="Nome do Material" required>
            </div>
            <button type="submit" class="btn btn-primary mb-2">Salvar</button>
        </form>
    </div>

    <!-- Formulário de edição (PUT) -->
    <div id="formMaterialEdit" style="display: none;" class="mb-4">
        <form onsubmit="event.preventDefault(); atualizarMaterial();" class="form-inline justify-content-center">
            <input type="hidden" id="editID">
            <div class="form-group mx-sm-3 mb-2">
                <input type="text" class="form-control" id="editNome" placeholder="Nome do Material" required>
            </div>
            <button type="submit" class="btn btn-warning mb-2">Atualizar</button>
        </form>
    </div>

    <!-- Tabela -->
    {% if materiais %}
        <table class="table table-striped table-bordered text-center align-middle">
            <thead class="thead-dark">
                <tr>
                    <th scope="col">ID</th>
                    <th scope="col">Material</th>
                    <th scope="col">Ações</th>
                </tr>
            </thead>
            <tbody>
                {% for m in materiais %}
                    <tr>
                        <td>{{ m['ID_Material'] }}</td>
                        <td>{{ m['Nome'] }}</td>
                        <td class="action-buttons">
                            <button class="btn btn-sm btn-primary"
                                    onclick="preencherFormularioEdicao('{{ m['ID_Material'] }}', '{{ m['Nome'] }}')">
                                Atualizar
                            </button>
                            <button class="btn btn-sm btn-danger"
                                    onclick="deletarMaterial('{{ m['ID_Material'] }}')">
                                Deletar
                            </button>
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    {% else %}
        <p class="text-center">Nenhum material disponível.</p>
    {% endif %}
</div>
</body>
</html>
