<!DOCTYPE html>
<html>
<head>
    <title>Lista de Formas</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"
          integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/formas.css') }}">
    <script>
        function toggleForm() {
            const formDiv = document.getElementById('formForma');
            formDiv.style.display = formDiv.style.display === 'none' ? 'block' : 'none';
        }

        function deletarForma(idForma) {
            fetch('/forma/delete/' + idForma, { method: 'DELETE' })
                .then(response => {
                    if (response.ok) {
                        location.reload();
                    } else {
                        alert('Erro ao deletar a forma.');
                    }
                })
                .catch(error => {
                    console.error('Erro na requisição:', error);
                    alert('Erro ao tentar deletar a forma.');
                });
        }

        function preencherFormularioEdicao(id, nome) {
            document.getElementById('editID').value = id;
            document.getElementById('editNome').value = nome;
            document.getElementById('formFormaEdit').style.display = 'block';
            window.scrollTo(0, 0);
        }

        function atualizarForma() {
            const id = document.getElementById('editID').value;
            const nome = document.getElementById('editNome').value;

            fetch('/forma/edit/' + id, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ Nome: nome })
            })
            .then(response => {
                if (response.ok) {
                    alert('Forma atualizada com sucesso!');
                    location.reload();
                } else {
                    alert('Erro ao atualizar a forma.');
                }
            })
            .catch(error => {
                console.error('Erro ao enviar atualização:', error);
                alert('Erro ao enviar a atualização.');
            });
        }
    </script>
</head>
<body>
<div class="container table-wrapper">
    <h1 class="text-center">Formas</h1>

    {% if error %}
        <div class="alert alert-warning text-center">{{ error }}</div>
    {% endif %}

    <!-- Botão para mostrar o formulário de criação -->
    <div class="text-center mb-3">
        <button class="btn btn-success" onclick="toggleForm()">+ Nova Forma</button>
    </div>

    <!-- Formulário de criação (POST) -->
    <div id="formForma" style="display: none;" class="mb-4">
        <form action="/forma" method="POST" class="form-inline justify-content-center">
            <div class="form-group mx-sm-3 mb-2">
                <input type="text" class="form-control" name="Nome" placeholder="Nome da Forma" required>
            </div>
            <button type="submit" class="btn btn-primary mb-2">Salvar</button>
        </form>
    </div>

    <!-- Formulário de edição (PUT) -->
    <div id="formFormaEdit" style="display: none;" class="mb-4">
        <form onsubmit="event.preventDefault(); atualizarForma();" class="form-inline justify-content-center">
            <input type="hidden" id="editID">
            <div class="form-group mx-sm-3 mb-2">
                <input type="text" class="form-control" id="editNome" placeholder="Nome da Forma" required>
            </div>
            <button type="submit" class="btn btn-warning mb-2">Atualizar</button>
        </form>
    </div>

    <!-- Tabela -->
    {% if formas %}
        <table class="table table-striped table-bordered text-center align-middle">
            <thead class="thead-dark">
                <tr>
                    <th scope="col">ID</th>
                    <th scope="col">Forma</th>
                    <th scope="col">Ações</th>
                </tr>
            </thead>
            <tbody>
                {% for f in formas %}
                    <tr>
                        <td>{{ f['ID_Forma'] }}</td>
                        <td>{{ f['Nome'] }}</td>
                        <td class="action-buttons">
                            <button class="btn btn-sm btn-primary"
                                    onclick="preencherFormularioEdicao('{{ f['ID_Forma'] }}', '{{ f['Nome'] }}')">
                                Atualizar
                            </button>
                            <button class="btn btn-sm btn-danger"
                                    onclick="deletarForma('{{ f['ID_Forma'] }}')">
                                Deletar
                            </button>
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    {% else %}
        <p class="text-center">Nenhuma forma disponível.</p>
    {% endif %}
</div>
</body>
</html>
